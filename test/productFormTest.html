<!DOCTYPE html>

<head>
    <style>
        div {
            display: flex;
        }
    </style>
</head>

<body>
    <div>
        <form id="productPostForm" enctype="multipart/form-data" action="http://localhost:8000/api/products/" method="POST" >
            <label for="name">name:</label><br>
            <input type="text" id="name" name="name" value="NomeProdottoTest" required><br><br>
            <label for="description">description:</label><br>
            <input type="text" id="description" name="description" value="descriptionTest" required><br><br>
            <label for="category">category:</label><br>
            <input type="text" id="category" name="category" value="categoryTest" required><br><br>
            <label for="subcategory">subcategory:</label><br>
            <input type="text" id="subcategory" name="subcategory" value="subcategoryTest"><br>
            <label for="image">image:</label><br>
            <input type="file" id="image" name="image"><br>

            <input type="submit" value="submit">
        </form>

        <form id="getProductForm" action="http://localhost:8000/api/products/" method="GET" >
            <label for="name">name:</label><br>
            <input type="text" id="getName" name="name" value="NomeProdottoTest" required><br><br>
            <input type="submit" value="submit">
        </form>
    </div>

    <div>

    </div>

    <script>
        const uri = "http://localhost:8000/api/products/"
        const adminToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRoIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImNpYW8iLCJpZCI6ImFzZG9pMDE5MjNlYXNkIiwiaWF0IjoxNjMzNzAwOTY0LCJleHAiOjE2MzYzNzkzNjR9._cIrkGfajb6DbVFiSxD0wU8SUjZ3kI3-ojV8Fu_a0Kw";

        const productPostForm = document.getElementById("productPostForm");
        productPostForm.addEventListener("submit", async function (event) {
            event.preventDefault();
            let data = new FormData(productPostForm);
            console.log(data);

            let response = await fetch(uri, {
                headers: {"Authorization": adminToken},
                method: "POST",
                body: data,
                mode: 'cors',
            });

            let text = await response.json();
            console.log(text);
        })

        const getProductForm = document.getElementById("getProductForm");
        getProductForm.addEventListener("submit", async function (event) {
            event.preventDefault();
            let data = document.getElementById("getName").value;
            console.log(data);

            let response = await fetch(uri + "?name=" + data, {
                headers: {"Authorization": adminToken},
                method: "GET",
                mode: 'cors',
            });

            let text = (await response.json())[0];
            console.log(text);
        })

        function serializeForm(form) {
            return Array.from(form.querySelectorAll('input, select, textarea'))
                .filter(element => element.name)
                .reduce((json, element) => {
                    json[element.name] = element.type === 'checkbox' ? element.checked : element.value;
                    return json;
                }, {});
        }

    </script>

</body>